<?php
	
/**
 * AgileBill - Open Billing Software
 *
 * This body of work is free software; you can redistribute it and/or
 * modify it under the terms of the Open AgileBill License
 * License as published at http://www.agileco.com/agilebill/license1-4.txt
 * 
 * For questions, help, comments, discussion, etc., please join the
 * Agileco community forums at http://forum.agileco.com/ 
 *
 * @link http://www.agileco.com/
 * @copyright 2004-2008 Agileco, LLC.
 * @license http://www.agileco.com/agilebill/license1-4.txt
 * @author Tony Landis <tony@agileco.com> 
 * @package AgileBill
 * @version 1.4.93
 */
	
class session
{

	# Open the constructor for this mod
	function session()
	{
		# name of this module:
		$this->module = "session";

		# location of the construct XML file:
		$this->xml_construct = PATH_MODULES . "" . $this->module . "/" . $this->module . "_construct.xml";

		# open the construct file for parsing	
		$C_xml = new CORE_xml;
		$construct = $C_xml->xml_to_array($this->xml_construct);

		$this->method   = $construct["construct"]["method"];
		$this->trigger  = $construct["construct"]["trigger"];
		$this->field    = $construct["construct"]["field"];
		$this->table 	= $construct["construct"]["table"];
		$this->module 	= $construct["construct"]["module"];
		$this->cache	= $construct["construct"]["cache"];
		$this->order_by = $construct["construct"]["order_by"];
		$this->limit	= $construct["construct"]["limit"];
	}


	##############################
	##	GRAPH STATISTICS        ##
	##############################
	function graph($start, $end, $constraint, $default)
	{
		global $C_translate;


		$db     = &DB();
		$sql    = 'SELECT date_orig FROM ' . AGILE_DB_PREFIX . 'session WHERE
					site_id     =  ' . $db->qstr(DEFAULT_SITE) . ' AND
					date_orig   >= ' . $db->qstr($start) . ' AND
					date_orig   <= ' . $db->qstr($end);

		$result = $db->Execute($sql);
		if($result->RecordCount() == 0)
		{
			$arr['title']   = $C_translate->translate('search_no_results','','');
			$arr['results'] = $default;
			return $arr;
		}
		$ii=0;
		while(!$result->EOF)
		{
			$d = $result->fields['date_orig'];
			for($i=0; $i<count($constraint); $i++)
			{
				if($d >= $constraint[$i]["start"] && $d < $constraint[$i]["end"])
				$default[$i]++;
				$ii++;
			}
			$result->MoveNext();
		}

		$C_translate->value['session']['count'] = $result->RecordCount();
		$title = $C_translate->translate('statistics','session','');
		$arr['title']   = $title;
		$arr['results'] = $default;
		return $arr;
	}


	##############################
	##		VIEW			    ##
	##############################
	function view($VAR)
	{	
		$type = "view";
		$this->method["$type"] = explode(",", $this->method["$type"]);
		$db = new CORE_database;
		 $db->view($VAR, $this, $type);
	}		

	##############################
	##		 DELETE	            ##
	##############################
	function delete($VAR)
	{	
		$db = new CORE_database;
		 $db->mass_delete($VAR, $this, "");
	}		

	##############################
	##	     SEARCH FORM        ##
	##############################
	function search_form($VAR)
	{
		$type = "search";
		$this->method["$type"] = explode(",", $this->method["$type"]);
		$db = new CORE_database;
		 $db->search_form($VAR, $this, $type);
	}

	##############################
	##		    SEARCH		    ##
	##############################
	function search($VAR)
	{	
		$type = "search";
		$this->method["$type"] = explode(",", $this->method["$type"]);
		$db = new CORE_database;
		 $db->search($VAR, $this, $type);
	}

	##############################
	##		SEARCH SHOW	        ##
	##############################

	function search_show($VAR)
	{	
		$type = "search";
		$this->method["$type"] = explode(",", $this->method["$type"]);
		$db = new CORE_database;
		 $db->search_show($VAR, $this, $type);
	}
}
?>